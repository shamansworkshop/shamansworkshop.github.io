<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Parkour Obby</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
        }

        /* The Game Container */
        #game-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* The Start Screen Overlay */
        #start-screen {
            position: absolute;
            z-index: 10; /* Sit on top of game */
            background: rgba(0, 0, 0, 0.85);
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }

        h1 { margin-bottom: 20px; font-size: 3em; }
        p { font-size: 1.5em; color: #ccc; margin-bottom: 40px; }

        /* Big Button for TV Remotes */
        #fs-btn {
            padding: 20px 40px;
            font-size: 2em;
            background-color: #28a745;
            color: white;
            border: 4px solid #fff;
            border-radius: 10px;
            cursor: pointer;
            outline: none; /* Remove default browser outline */
            transition: transform 0.1s;
        }

        /* Style when selected by TV Remote */
        #fs-btn:focus, #fs-btn:hover {
            background-color: #34ce57;
            transform: scale(1.1);
            box-shadow: 0 0 20px white;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
</head>
<body>

    <div id="game-container"></div>

    <div id="start-screen">
        <h1>TV Parkour</h1>
        <p>Press <b>OK</b> on the button below to start.</p>
        <button id="fs-btn">PLAY IN FULLSCREEN</button>
    </div>

<script>
    // --- FULLSCREEN LOGIC ---
    const startScreen = document.getElementById('start-screen');
    const fsBtn = document.getElementById('fs-btn');
    
    // Auto-focus the button so the user can just hit "OK" immediately
    fsBtn.focus();

    fsBtn.addEventListener('click', () => {
        // 1. Request Fullscreen (Handles standard + Webkit for older TVs)
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) { /* Safari/Chrome/Old Webkit */
            elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) { /* IE11/Old Edge */
            elem.msRequestFullscreen();
        }

        // 2. Hide the menu
        startScreen.style.display = 'none';

        // 3. Start the game logic
        startGame();
    });

    // --- GAME CONFIGURATION ---
    let gameActive = false; // Game is frozen until button clicked

    const config = {
        type: Phaser.AUTO,
        scale: {
            mode: Phaser.Scale.FIT,
            parent: 'game-container', // Attach to our specific div
            autoCenter: Phaser.Scale.CENTER_BOTH,
            width: 1280,
            height: 720
        },
        backgroundColor: '#87CEEB',
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 700 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    const game = new Phaser.Game(config);

    // Variables
    let player;
    let cursors;
    let enterKey;
    let platforms;
    let goal;
    let lava;
    let textInfo;

    function startGame() {
        gameActive = true;
    }

    // 1. PRELOAD
    function preload() {
        // Graphics generation
        const gPlayer = this.make.graphics({x:0, y:0, add:false});
        gPlayer.fillStyle(0xff0000, 1);
        gPlayer.fillRect(0,0, 32,32);
        gPlayer.generateTexture('playerTex', 32, 32);

        const gPlat = this.make.graphics({x:0, y:0, add:false});
        gPlat.fillStyle(0x00aa00, 1);
        gPlat.fillRect(0,0, 32,32);
        gPlat.generateTexture('platformTex', 32, 32);

        const gGoal = this.make.graphics({x:0, y:0, add:false});
        gGoal.fillStyle(0xffd700, 1);
        gGoal.fillRect(0,0, 40,40);
        gGoal.generateTexture('goalTex', 40, 40);

        const gLava = this.make.graphics({x:0, y:0, add:false});
        gLava.fillStyle(0xff4500, 1);
        gLava.fillRect(0,0, 32,32);
        gLava.generateTexture('lavaTex', 32, 32);
    }

    // 2. CREATE
    function create() {
        // --- INPUTS ---
        cursors = this.input.keyboard.createCursorKeys();
        enterKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER);

        // --- WORLD ---
        platforms = this.physics.add.staticGroup();
        lava = this.physics.add.staticGroup();

        // Level Design
        createPlatform(platforms, 100, 600, 10); // Start
        createPlatform(platforms, 400, 500, 3);
        createPlatform(platforms, 650, 420, 2);
        createPlatform(platforms, 900, 320, 3);
        createPlatform(platforms, 1200, 250, 4); // End platform

        // Lava floor
        let lavaFloor = lava.create(640, 715, 'lavaTex');
        lavaFloor.setScale(80, 1).refreshBody();

        // Player
        player = this.physics.add.sprite(100, 450, 'playerTex');
        player.setBounce(0.1);
        player.setCollideWorldBounds(true);

        // Goal
        goal = this.physics.add.staticSprite(1200, 200, 'goalTex');

        // Collisions
        this.physics.add.collider(player, platforms);
        this.physics.add.collider(player, lava, hitLava, null, this);
        this.physics.add.overlap(player, goal, hitGoal, null, this);

        // UI Text
        textInfo = this.add.text(16, 16, 'Waiting for Fullscreen...', { 
            fontSize: '24px', 
            fill: '#000', 
            fontFamily: 'Arial',
            fontStyle: 'bold'
        });
    }

    // Helper
    function createPlatform(group, x, y, width) {
        group.create(x, y, 'platformTex').setScale(width, 1).refreshBody();
    }

    // 3. UPDATE
    function update() {
        // --- CRITICAL: STOP CONTROLS IF NOT STARTED ---
        if (!gameActive) {
            textInfo.setText("Click the Button to Start");
            return;
        }

        // Reset Text
        if(!textInfo.text.includes("Win")) {
            textInfo.setText("ARROWS to Move | OK/ARROW UP to Jump");
        }

        // --- MOVEMENT ---
        if (cursors.left.isDown) {
            player.setVelocityX(-300);
        }
        else if (cursors.right.isDown) {
            player.setVelocityX(300);
        }
        else {
            player.setVelocityX(0);
        }

        // --- JUMPING ---
        // Allow Up Arrow OR Enter Key
        const jumpPressed = cursors.up.isDown || Phaser.Input.Keyboard.JustDown(enterKey);
        
        if (jumpPressed && player.body.touching.down) {
            player.setVelocityY(-550);
        }
    }

    // --- EVENTS ---
    function hitLava(player, lava) {
        this.cameras.main.shake(100, 0.01);
        player.setX(100);
        player.setY(450);
        player.setVelocity(0, 0);
    }

    function hitGoal(player, goal) {
        textInfo.setText('YOU WIN! Press OK to Reset');
        textInfo.setStyle({ fontSize: '40px', color: '#fff', backgroundColor: '#00aa00' });
        textInfo.setX(game.config.width / 2 - 250);
        textInfo.setY(300);
        
        this.physics.pause();
        gameActive = false; // Stop update loop logic

        // Allow restart only via Enter key
        this.input.keyboard.once('keydown-ENTER', () => {
            this.scene.restart();
            gameActive = true;
        });
    }

</script>
</body>
</html>
